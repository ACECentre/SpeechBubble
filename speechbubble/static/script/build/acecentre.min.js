/*! acecentre 2014-11-30 */
var app=angular.module("speechBubble",["checklist-model","ui.bootstrap","angular-flash.service","angular-flash.flash-alert-directive","dialogs.main","pascalprecht.translate"]).config(["flashProvider",function(a){a.errorClassnames.push("alert-danger")}]);app.controller("EditFormCtrl",["$scope","$window","dataFactory","dialogs","ProductDataService",function(a,b,c,d,e){a.lang="en-US",a.language="English",a.form_data=e.form_data,a.product=e,a.display_rules={},a.field_state={},a.create=function(){response=c.createItem(a.form_data),response.success(function(c){c.errors?a.field_errors=c.errors:b.location.href="/edit/"+c.id})},a.delete=function(){var e=d.confirm("Please Confirm","Are you sure you want to delete this draft?");e.result.then(function(){c.deleteDraft(a.itemId,a.userId).success(function(){b.location="/"})},function(){})},a.load=function(b,c){a.itemId=b,a.userId=c,console.log(e),e.load(b,c),a.form_data=e.form_data},a.moderation=function(b){c.moderationAction(a.modId,b).success(function(){})}}]),app.controller("EditSideBarCtrl",["$scope","ProductDataService",function(a,b){a.product=b,a.save=function(){b.save()},a.publishRequest=function(){b.publishRequest()}}]),app.controller("SupplierEditCtrl",["$scope",function(){}]),app.controller("SupplierListCtrl",["$scope",function(a){a.selectedRegions=[]}]),app.factory("dataFactory",["$http",function(a){var b="/api/",c={};return c.createItem=function(c){return a.post(b+"product/create",c)},c.saveDraft=function(c,d,e){return a.put(b+"product/"+c+"/"+d,e)},c.deleteDraft=function(c,d){return a.delete(b+"product/"+c+"/"+d)},c.getDraft=function(c,d){return a.get(b+"product/"+c+"/"+d)},c.getOrCreateDraft=function(c,d){return a.post(b+"product/"+c+"/"+d)},c.moderationRequest=function(c,d,e){return a.post(b+"moderation/create/"+c+"/"+d,e)},c.moderationAction=function(c,d){return a.post(b+"moderation/"+c+"/"+d)},c}]),app.factory("ProductDataService",["dataFactory","$window","flash",function(a,b,c){var d={};return d.form_data={},d.display_rules={},d.field_state={},d.field_errors={},d.save=function(){response=a.saveDraft(d.itemId,d.userId,d.form_data),response.success(function(a){d.field_errors={},a.errors?d.field_errors=a.errors:(d.saved=a.success,d.stats=a.stats,c.success="Saved!")})},d.load=function(c,e){d.itemId=c,d.userId=e,a.getDraft(c,e).success(function(a){a.success?(d.form_data=a.data,d.stats=a.stats,console.log(a.moderation),d.isModerating=a.moderation?!0:!1):b.location="/"})},d.publishRequest=function(){response=a.moderationRequest(d.itemId,d.userId,d.form_data),console.log("======================================="),console.log(d.form_data),response.success(function(a){d.field_errors={},a.failed?c.error=a.failed:a.errors?(d.field_errors=a.errors,console.log(a.errors),c.error="Unable to finalise document - please correct the form errors and try again."):(c.success="Thanks. This draft will be reviewed by our moderators.",d.isModerating=!0)})},d}]),app.directive("sbConditionalRule",["$parse",function(){return{restrict:"E",link:function(a,b,c){if(a.product.form_data||(a.product.form_data={}),!c.show||!c.when||!c.is)throw"You must supply `show` and `when` and `is` attributes";a.display_rules[c.show]=[c.when,c.is],a.$watch("product.form_data."+c.when,function(b){var d=!0,e=angular.isArray(b)?b:[b];if(-1!==c.is.indexOf("["))var f=a.$eval(c.is);else var f=c.is;angular.isArray(f)?d=_.intersection(e,f).length>0:_.contains(["True","False",f])?console.log("boolean comparison"):d=_.contains(e,f),a.field_state[c.show]=d},!0)}}}]),app.directive("sbShowIfVisible",["$parse",function(){return{link:function(a,b,c){var d=c.sbShowIfVisible;void 0===a.field_state[d]&&(a.field_state[d]=""),a.$watch("field_state."+d,function(a){b.css("display",a?"block":"none")})}}}]);